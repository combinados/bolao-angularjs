"use strict";angular.module("bolao.acordeon",[]).directive("acordeon",function(){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/acordeon/diretivas/diretiva-acordeon.html",scope:"true",controller:["$scope",function(o){o.itens=[];var a=this,e=2,t=0,i=0,r=0,n=2,s=0,l=0,c=function(a){e>r?(a.tipo="item-premiado",r++,0===t&&(t=a.boleiro.pontos),t>a.boleiro.pontos&&(t=a.boleiro.pontos)):t<a.boleiro.pontos?(angular.forEach(o.itens,function(o){o.boleiro.pontos===t&&(o.tipo="")}),t=a.boleiro.pontos,a.tipo="item-premiado"):t===a.boleiro.pontos?angular.forEach(o.itens,function(o){o.boleiro.pontos===t&&(a.boleiro.placares>o.boleiro.placares?(o.tipo="",a.tipo="item-premiado"):a.boleiro.placares===o.boleiro.placares&&(a.tipo="item-premiado"))}):d(a)},d=function(a){n>s?(a.tipo="item-rebaixado",s++,0===i&&(i=a.boleiro.pontos),i<a.boleiro.pontos&&(i=a.boleiro.pontos)):i>=a.boleiro.pontos&&angular.forEach(o.itens,function(e){e.boleiro.pontos<=i&&(e.boleiro.pontos>a.boleiro.pontos&&(e.tipo="",a.tipo="item-rebaixado",angular.forEach(o.itens,function(o){i=o.boleiro.pontos<e.boleiro.pontos&&o.boleiro.pontos>a.boleiro.pontos?o.boleiro.pontos:a.boleiro.pontos})),e.boleiro.pontos===a.boleiro.pontos&&(e.boleiro.placares>a.boleiro.placares&&(e.tipo="",a.tipo="item-rebaixado",angular.forEach(o.itens,function(o){i=o.boleiro.pontos<e.boleiro.pontos&&o.boleiro.pontos>a.boleiro.pontos?o.boleiro.pontos:a.boleiro.pontos})),e.boleiro.placares===a.boleiro.placares&&(a.tipo="item-rebaixado",i=a.boleiro.pontos)))})};a.adicionarItem=function(a){a.tipo="premiado",c(a),o.itens.push(a)},a.abrir=function(a){a===l?o.itens[l].visivel?o.itens[a].ocultar():o.itens[a].exibir():(o.itens[l].ocultar(),o.itens[a].exibir()),l=a}}]}}).directive("item",["BD",function(o){return{require:"^acordeon",restrict:"E",transclude:"true",replace:"true",scope:{boleiro:"=",indice:"@"},link:function(a,e,t,i){a.direcao="esquerda",a.exibir=function(){a.visivel=!0,a.situacao="item-aberto"},a.abrir=function(e){var t=a.boleiro.rodadas;"object"==typeof t&&t instanceof Array&&(t.length||a.boleiro.rodadas.push(o.pegarRodada(a.boleiro.id,1))),i.abrir(e)},a.ocultar=function(){a.visivel=!1,a.situacao="item-fechado"},a.ocultar(),i.adicionarItem(a)},templateUrl:"components/acordeon/diretivas/diretiva-item.html"}}]),angular.module("bolao.carrossel",[]).directive("carrossel",["BD","$timeout",function(o,a){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/carrossel/diretivas/diretiva-carrossel.html",scope:{totalPaginas:"=",boleiro:"="},controller:["$scope",function(e){e.direcao="esquerda",e.paginas=[];var t=this,i=1,r=function(o){angular.forEach(e.paginas,function(a){return a.conteudo.id===o?void a.exibir():void 0})};e.atualizarPagina=function(t,n){e.direcao=void 0===n?i>=t?"esquerda":"direita":n;var s=!0,l=!1;angular.forEach(e.paginas,function(o){o.conteudo.id===i&&(o.ocultar(),l=!0),o.conteudo.id===t&&(s=!1),!s&&l}),s&&e.boleiro.rodadas.push(o.pegarRodada(e.boleiro.id,t)),a(function(){r(t)},100),i=t},e.ehPaginaAtual=function(o){return i===o},e.proximaPagina=function(){var o=i,a=o<e.totalPaginas?++o:1;e.atualizarPagina(a,"direita")},e.paginaAnterior=function(){var o=i,a=o>1?--o:e.totalPaginas;e.atualizarPagina(a,"esquerda")},t.adicionarPagina=function(o){1===i&&o.exibir(),e.paginas.push(o)}}]}}]).directive("pagina",function(){return{require:"^carrossel",restrict:"E",transclude:"true",replace:"true",scope:{conteudo:"="},link:function(o,a,e,t){o.exibir=function(){o.visivel=!0,o.detalheVisivel=!0},o.ocultar=function(){o.visivel=!1,o.detalheVisivel=!1},o.alternarDetalhe=function(){o.detalheVisivel=!o.detalheVisivel},o.ocultar(),t.adicionarPagina(o)},templateUrl:"components/carrossel/diretivas/diretiva-paginas.html"}}),angular.module("bolao",["bolao.carrossel","bolao.acordeon","ngTouch"]),angular.module("bolao").factory("BD",["$http","$templateCache",function(o,a){var e,t,i="bd.json",r=function(o){return"Gabarito"!==o.nome?n(o):void(t=o)},n=function(o){for(var a=null,e=0;e<o.rodadas.length;e++){a=o.rodadas[e];for(var i=0;i<a.jogos.length;i++){var r=a.jogos[i],n=t.rodadas[e].jogos[i];r.pontos=s(r,n),a.pontos+=r.pontos}}o.pontos=o.rodadas.reduce(function(o,a){return o+a.pontos},0);for(var l=0;l<o.rodadas.length;l++){var c=o.rodadas[l].jogos.filter(function(o){return 3===o.pontos?o:void 0});o.placares+=o.rodadas[l].placares=c.length}var d=o.rodadas.filter(function(o){return o.pontos>0}).length;return o.mediaPontos=o.pontos/d,o.mediaPlacares=o.placares/d,o.totalRodadas=o.rodadas.length,o},s=function(o,a){return""===a.mandante.gols||""===a.visitante.gols||""===o.mandante.gols||""===o.visitante.gols?0:a.mandante.gols===o.mandante.gols&&a.visitante.gols===o.visitante.gols?3:a.mandante.gols===a.visitante.gols&&o.mandante.gols===o.visitante.gols||a.mandante.gols<a.visitante.gols&&o.mandante.gols<o.visitante.gols||a.mandante.gols>a.visitante.gols&&o.mandante.gols>o.visitante.gols?1:0},l=function(o){return angular.extend(c(o.id),o),o.rodadas=[],o},c=function(o){var a=e.filter(function(a){return a.id===o?a:void 0});return a[0]},d=function(o,a){for(var e=0;e<a.length;e++)if(a[e].id===o)return a[e]};return{pegarBoleiros:function(){return o({method:"GET",url:i,cache:a,headers:{"X-Api-Secret":"xxx",Authorization:"xxx","Content-Type":"undefined"}}).then(function(o){e=o.data;var a=JSON.parse(JSON.stringify(o.data));return a.filter(r).map(l)})},pegarRodada:function(o,a){var e=c(o);return d(a,e.rodadas)}}}]),angular.module("bolao").controller("NavbarCtrl",["$scope",function(o){o.date=new Date}]),angular.module("bolao").controller("ControlePrincipal",["$scope","BD",function(o,a){o.boleiros=[],a.pegarBoleiros().then(function(a){o.boleiros=a})}]),angular.module("bolao").run(["$templateCache",function(o){o.put("components/navbar/navbar.html",'<nav class="navbar" ng-controller="NavbarCtrl"><a href="https://github.com/Swiip/generator-gulp-angular">Gulp Angular</a><ul><li class="active"><a ng-href="#">Home</a></li><li><a ng-href="#">About</a></li><li><a ng-href="#">Contact</a></li></ul><ul><li><a ng-href="#">Current date: {{ date | date:\'yyyy-MM-dd\' }}</a></li></ul></nav>'),o.put("components/acordeon/diretivas/diretiva-acordeon.html",'<div class="acordeon" ng-transclude=""></div>'),o.put("components/acordeon/diretivas/diretiva-item.html",'<div class="item {{situacao}}"><div class="item-cabecalho {{situacao}} {{tipo}}" ng-click="abrir(indice)"><figure><img ng-src="{{boleiro.foto}}"> <img ng-src="{{boleiro.campeao.escudo}}"><figcaption>Meu campeão: {{boleiro.campeao.pontos}} pontos</figcaption></figure><div class="nome">{{boleiro.nome}}</div><div class="valores">Pontos<br>{{boleiro.pontos}}</div><div class="valores">Placares<br>{{boleiro.placares}}</div></div><div ng-transclude=""></div></div>'),o.put("components/carrossel/diretivas/diretiva-carrossel.html",'<div class="carrossel"><nav class="navegacao"><ul class="pontos"><li class="ponto" ng-class="{\'ativo\':ehPaginaAtual($index + 1)}" ng-repeat="pagina in (0|number:totalPaginas - 2 ) track by $index" ng-click="atualizarPagina($index + 1);">{{$index + 1}}</li></ul></nav><div ng-transclude="" class="paginas {{direcao}}" ng-swipe-left="paginaAnterior()" ng-swipe-right="proximaPagina()"></div><a class="seta anterior" ng-click="paginaAnterior()"></a> <a class="seta proxima" ng-click="proximaPagina()"></a></div>'),o.put("components/carrossel/diretivas/diretiva-paginas.html",'<div class="pagina" ng-hide="!visivel"><div class="conteudo" ng-transclude="" ng-click="alternarDetalhe()"></div><div ng-click="alternarDetalhe()" class="detalhe" ng-class="{ocultar : !detalheVisivel}"><table class="detalhe-rodada"><tr><td class="cabecalho-detalhe-rodada" colspan="4">Detalhes da Rodada</td></tr><tr><td class="esquerda">Número:</td><td class="esquerda">{{conteudo.id}}</td><td class="esquerda">Total de Pontos:</td><td class="direita">{{conteudo.pontos}}</td></tr><tr><td class="esquerda">Data:</td><td class="esquerda">{{conteudo.data | date : \'dd/MM/yyyy\'}}</td><td class="esquerda">Total de Placares:</td><td class="direita">{{conteudo.Placares}}</td></tr></table></div></div>')}]);